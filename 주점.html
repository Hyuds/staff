<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      html, body { height: 100%; margin: 0; padding: 0; }
      body {
        display: flex; justify-content: center; align-items: center;
        background-color: #f7f7f7; font-family: Arial, sans-serif;
      }
      .main-button {
        padding: 10px 20px; font-size: 16px; background-color: #4CAF50;
        color: white; border: none; border-radius: 6px; cursor: pointer;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2); transition: all 0.3s ease;
      }
      .main-button:hover {
        background-color: #45a049; transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <button class="main-button" onclick="openStaffCallForm()">ğŸ› ì§ì› í˜¸ì¶œí•˜ê¸°</button>
    <script>
      // ì—¬ê¸°ì— ë³¸ì¸ì˜ Apps Script Web App URLì„ ì…ë ¥í•˜ì„¸ìš”
      const GAS_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyWReOObWE5IKi5_1BfHXZ81JyHdrfD0ofStj7C4VIvm9wsiRUwAWByIirDoXaRHZVr/exec';

      function openStaffCallForm() {
        const newWindow = window.open('', '_blank', 'width=500,height=600,resizable=yes');
        newWindow.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <base target="_top">
            <title>ì§ì› í˜¸ì¶œí•˜ê¸°</title>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; background-color: #f7f7f7; }
              h3 { text-align: center; font-size: 24px; margin-bottom: 20px; }
              .form-container { background-color: #ffffff; padding: 25px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
              label { display: block; margin: 15px 0; font-size: 16px; }
              input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; box-sizing: border-box; margin-top: 5px; }
              input[type="number"] { width: 80px; margin-left: 10px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; display: none; }
              .button-group { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
              button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
              button.submit-btn { background-color: #4CAF50; color: white; }
              button.cancel-btn { background-color: #f44336; color: white; }
              .loading-container { display: none; text-align: center; padding: 50px; }
              .spinner { margin: 20px auto; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #4CAF50; border-radius: 50%; animation: spin 1s linear infinite; }
              @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            </style>
          </head>
          <body>
            <div id="formContainer" class="form-container">
              <h3>ğŸ› ì§ì› í˜¸ì¶œí•˜ê¸°</h3>
              <label for="table-number">í…Œì´ë¸” ë²ˆí˜¸:</label>
              <input type="text" id="table-number" placeholder="í…Œì´ë¸” ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              <label><input type="checkbox" id="spoonBox" onchange="toggleQty('spoon')"> ìˆŸê°€ë½<input type="number" id="spoonQty" min="1" placeholder="ê°œìˆ˜"></label>
              <label><input type="checkbox" id="chopsticksBox" onchange="toggleQty('chopsticks')"> ì “ê°€ë½<input type="number" id="chopsticksQty" min="1" placeholder="ê°œìˆ˜"></label>
              <label><input type="checkbox" id="smallCupBox" onchange="toggleQty('smallCup')"> ì‘ì€ì»µ<input type="number" id="smallCupQty" min="1" placeholder="ê°œìˆ˜"></label>
              <label><input type="checkbox" id="comeToTable"> í…Œì´ë¸”ë¡œ ì™€ì£¼ì„¸ìš”</label>
              <label><input type="checkbox" id="etc"> ê¸°íƒ€</label>
              <div class="button-group">
                <button class="submit-btn" onclick="submitForm()">âœ… í˜¸ì¶œí•˜ê¸°</button>
                <button class="cancel-btn" onclick="resetForm()">âŒ ì´ˆê¸°í™”</button>
              </div>
            </div>
            <div id="loadingContainer" class="loading-container">
              <p style="font-size: 20px;">ğŸ› í˜¸ì¶œ ìš”ì²­ì„ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
              <div class="spinner"></div>
            </div>
            <script>
              function toggleQty(item) {
                const checkbox = document.getElementById(item + "Box");
                const qtyInput = document.getElementById(item + "Qty");
                qtyInput.style.display = checkbox.checked ? "inline-block" : "none";
                if (!checkbox.checked) qtyInput.value = "";
              }
              function submitForm() {
                const data = {
                  spoon: document.getElementById("spoonBox").checked ? parseInt(document.getElementById("spoonQty").value || 0) : 0,
                  chopsticks: document.getElementById("chopsticksBox").checked ? parseInt(document.getElementById("chopsticksQty").value || 0) : 0,
                  smallCup: document.getElementById("smallCupBox").checked ? parseInt(document.getElementById("smallCupQty").value || 0) : 0,
                  comeToTable: document.getElementById("comeToTable").checked,
                  etc: document.getElementById("etc").checked
                };
                if (data.spoon === 0 && data.chopsticks === 0 && data.smallCup === 0 && !data.comeToTable && !data.etc) {
                  alert("ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ìš”ì²­ì„ ì„ íƒí•˜ì„¸ìš”.");
                  return;
                }
                const tableNumber = document.getElementById("table-number").value;
                if (!tableNumber) {
                  alert("í…Œì´ë¸” ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
                  return;
                }
                document.getElementById('formContainer').style.display = 'none';
                document.getElementById('loadingContainer').style.display = 'block';
                data.tableNumber = tableNumber;

                // fetchë¡œ Apps Script Web Appì— POST ìš”ì²­
                fetch('${GAS_WEBAPP_URL}', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(result => {
                  if(result.status === 'success') {
                    document.body.innerHTML = \`
                      <div class="success-container" style="text-align:center;padding:30px;background:white;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.3);">
                        <div class="success-icon" style="font-size:48px;color:#4CAF50;margin-bottom:20px;">âœ…</div>
                        <p style="font-size:20px;">\${result.message}</p>
                        <button class="close-btn" style="margin-top:20px;padding:10px 20px;background-color:#4CAF50;color:white;border:none;border-radius:5px;cursor:pointer;" onclick="window.close()">ë‹«ê¸°</button>
                      </div>
                    \`;
                  } else {
                    showError(result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                  }
                })
                .catch(error => {
                  showError(error.message || 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                });
              }
              function showError(msg) {
                document.body.innerHTML = \`
                  <div class="error-container" style="text-align:center;padding:30px;background:white;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.3);">
                    <div class="error-icon" style="font-size:48px;color:#f44336;margin-bottom:20px;">âŒ</div>
                    <p style="font-size:20px;">ì˜¤ë¥˜ ë°œìƒ: \${msg}</p>
                    <button class="close-btn" style="margin-top:20px;padding:10px 20px;background-color:#f44336;color:white;border:none;border-radius:5px;cursor:pointer;" onclick="window.close()">ë‹«ê¸°</button>
                  </div>
                \`;
              }
              function resetForm() {
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('input[type="number"]').forEach(input => {
                  input.value = "";
                  input.style.display = "none";
                });
                document.getElementById("table-number").value = "";
              }
            <\/script>
          </body>
          </html>
        `);
        newWindow.document.close();
      }
    </script>
  </body>
</html>
